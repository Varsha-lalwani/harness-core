spec:
  execution:
    steps:
      - step:
          name: "Deploy"
          identifier: Deploy
          type: Command
          timeout: 10m
          strategy:
            repeat:
              items: <+stage.output.hosts>
              maxConcurency: <+maxConcurrency>
              unit: <+unit>
          spec:
            host: <+repeat.item>
            onDelegate: false
            environmentVariables: [ ]
            outputVariables: [ ]
            commandUnits:
              - identifier: Setup_Runtime_Paths
                name: Setup Runtime Paths
                type: Script
                spec:
                  shell: Bash
                  source:
                    type: Inline
                    spec:
                      script: |-
                        <+setup_runtime_paths_script>
              - identifier: Stop_Service
                name: "Stop Service"
                type: Script
                spec:
                  workingDirectory: $HARNESS_RUNTIME_PATH/tomcat/bin
                  shell: Bash
                  source:
                    type: Inline
                    spec:
                      script: "# [ -f ./shutdown.sh ] && ./shutdown.sh  || true"
              - identifier: Process_Stopped
                name: "Process Stopped"
                type: Script
                spec:
                  workingDirectory: $HARNESS_RUNTIME_PATH/tomcat/bin
                  shell: Bash
                  source:
                    type: Inline
                    spec:
                      script: |-
                        <+process_stop_script>
              - identifier: Port_Cleared
                name: "Port Cleared"
                type: Script
                spec:
                  workingDirectory: $HARNESS_RUNTIME_PATH/tomcat/bin
                  shell: Bash
                  source:
                    type: Inline
                    spec:
                      script: |-
                        <+port_cleared_script>
              - identifier: Copy_Artifact
                name: "Copy Artifact"
                type: Copy
                spec:
                  sourceType: Artifact
                  destinationPath: $HARNESS_RUNTIME_PATH
              - identifier: Copy_Config
                name: "Copy Config"
                type: Copy
                spec:
                  sourceType: Config
                  destinationPath: $HARNESS_RUNTIME_PATH
              - identifier: Start_Service
                name: "Start Service"
                type: Script
                spec:
                  workingDirectory: $HARNESS_RUNTIME_PATH/tomcat/bin
                  shell: Bash
                  source:
                    type: Inline
                    spec:
                      script: "# ./startup.sh"
              - identifier: Process_Running
                name: "Process Running"
                type: Script
                spec:
                  workingDirectory: $HARNESS_RUNTIME_PATH/tomcat/bin
                  shell: Bash
                  source:
                    type: Inline
                    spec:
                      script: |-
                        <+process_run_script>
              - identifier: Port_Listening
                name: "Port Listening"
                type: Script
                spec:
                  workingDirectory: $HARNESS_RUNTIME_PATH/tomcat/bin
                  shell: Bash
                  source:
                    type: Inline
                    spec:
                      script: |-
                        <+port_listening_script>